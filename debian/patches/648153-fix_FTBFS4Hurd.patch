From: Svante Signell <svante.signell@telia.com>
Origin: other, http://bugs.debian.org/648153
Bugs-Debian: http://bugs.debian.org/648153
Last-Update: 2012-01-21
Forwarded: no
Description: fix FTBFS problems of abiword on GNU/Hurd
 Solves the FTBFS problems of abiword on GNU/Hurd.
 In the first path config.h is included to make possible to
 check if TOOLKIT_GTK is defined. The second part use dynamic memory
 allocation to avoid the absence of a PATH_MAX definition for GNU/Hurd.

--- a/src/af/util/xp/ut_path.h
+++ b/src/af/util/xp/ut_path.h
@@ -29,6 +29,8 @@
 #include <limits.h>
 #endif
 
+#include "config.h"
+
 /* GTK build supports platforms without PATH_MAX; we leave the warning in for
  * other platforms to avoid headaches
  */
--- a/src/af/xap/gtk/xap_UnixApp.cpp
+++ b/src/af/xap/gtk/xap_UnixApp.cpp
@@ -258,15 +258,16 @@
 {
 	// FIXME: this code sucks hard
 
-	char buf[PATH_MAX];
+	char * buf = NULL;
 	
 	// see if ABIWORD_DATADIR was set in the environment
 	const char * sz = getenv("ABIWORD_DATADIR");
 	if (sz && *sz)
 	{
+		int len = strlen(sz);
+		buf = (gchar *)g_malloc(len+1);
 		strcpy(buf,sz);
 		char * p = buf;
-		int len = strlen(p);
 		if ( (p[0]=='"') && (p[len-1]=='"') )
 		{
 			// trim leading and trailing DQUOTES
@@ -277,6 +278,7 @@
 		if (p[len-1]=='/')				// trim trailing slash
 			p[len-1] = 0;
 		XAP_App::_setAbiSuiteLibDir(p);
+		g_free(buf);
 		return;
 	}
 
