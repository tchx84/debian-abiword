Last-Update: 2012-08-16
From: Ingo Br√ºckl <ib@wupperonline.de>
Forwarded: non-needed
Applied-Upstream: r31753
Bug-Debian: http://bugs.debian.org/681060
Bug-Abiword: http://bugzilla.abisource.com/show_bug.cgi?id=13280
Description: backported fix for "crash on unicode character(s) paste".
 Don't paste from buffer if character conversion has failed.
 Otherwise a segmentation fault will occur.

--- a/src/wp/ap/gtk/ap_UnixApp.cpp
+++ b/src/wp/ap/gtk/ap_UnixApp.cpp
@@ -767,10 +767,12 @@
 		{
 			UT_uint32 iread,iwritten = 0;
 			const char * szutf8= static_cast<const char *>(UT_convert(reinterpret_cast<const char *>(pData),iLen,szRes,"UTF-8",&iread,&iwritten));
+			if (szutf8) {
 			IE_Imp_XHTML * pImpHTML = new IE_Imp_XHTML(pDocRange->m_pDoc);
 			bSuccess = pImpHTML->pasteFromBuffer(pDocRange,reinterpret_cast<const unsigned char *>(szutf8),iwritten,"UTF-8");
 			g_free(const_cast<char *>(szutf8));
 			DELETEP(pImpHTML);
+			}
 		}
 		else
 		{
