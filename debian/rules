#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/gnome.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

DEB_CONFIGURE_EXTRA_FLAGS := --disable-gnomeui --disable-gnomevfs #--enable-libabiword
DEB_INSTALL_DOCS_ALL := CREDITS.TXT

upstreamtmpfiles = src/pkg/maemo/abiword.desktop src/pkg/maemo/com.abisource.abiword.service src/wp/main/win/abi_ver.cpp

# Put aside upstream cruft during build
pre-build:: debian/stamp-upstreamtmpstuff
debian/stamp-upstreamtmpstuff:
	for file in $(upstreamtmpfiles); do \
		[ ! -e $$file ] || [ -e $$file.upstream ] || mv $$file $$file.upstream; \
	done
	touch $@

binary-install/abiword::
	# Install /usr/share/mime-info/abiword.mime
	install -m 644 $(CURDIR)/debian/misc/abiword.mime \
	  $(CURDIR)/debian/$(cdbs_curpkg)/usr/share/mime-info

	# Move the icon into more appropriate size, format & place
	install -m 644 $(CURDIR)/debian/misc/abiword.xpm \
	  $(CURDIR)/debian/$(cdbs_curpkg)/usr/share/pixmaps
	mv -f $(CURDIR)/debian/$(cdbs_curpkg)/usr/share/icons/abiword_48.png \
	  $(CURDIR)/debian/$(cdbs_curpkg)/usr/share/pixmaps
	rm -rf $(CURDIR)/debian/$(cdbs_curpkg)/usr/share/icons

clean::
	rm -rf $(CURDIR)/.pc
	rm -f $(CURDIR)/*.cdbs-config_list

# Revert upstream stuff put aside during build
clean::
	for file in $(upstreamtmpfiles); do \
		[ ! -e $$file.upstream ] || mv -f $$file.upstream $$file; \
	done
	rm -f debian/stamp-upstreamtmpstuff
